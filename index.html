<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>For Stanley</title>
    
    <!-- å¼•å…¥ React å’Œ ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- å¼•å…¥ Babel ç”¨ä¾†è§£æ JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- å¼•å…¥ Google Fonts (æ‰‹å¯«é¢¨æ ¼) -->
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&display=swap" rel="stylesheet">

    <style>
        @keyframes fade-in {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        .animate-fade-in {
            animation: fade-in 0.5s ease-out forwards;
        }
        
        @keyframes bounce-slow {
            0%, 100% { transform: translateY(-5%); }
            50% { transform: translateY(0); }
        }
        .animate-bounce-slow {
            animation: bounce-slow 3s infinite;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        .animate-shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }
        
        /* èˆŠå­—æ¯é£›å‡º */
        @keyframes fly-out {
            0% { opacity: 1; transform: translate(0, 0) scale(1); }
            100% { opacity: 0; transform: translate(var(--tx), var(--ty)) scale(0.5) rotate(var(--rot)); }
        }
        .letter-fly-out {
            display: inline-block;
            animation: fly-out 0.8s forwards ease-in;
        }

        /* æ–°å­—æ¯é£›å…¥å®šä½ */
        @keyframes fly-in {
            0% { opacity: 0; transform: translate(var(--tx), var(--ty)) scale(1.5) rotate(var(--rot)); filter: blur(4px); }
            100% { opacity: 1; transform: translate(0, 0) scale(1) rotate(0); filter: blur(0); }
        }
        .letter-fly-in {
            display: inline-block;
            opacity: 0; /* åˆå§‹éš±è— */
            animation: fly-in 1s forwards cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            overflow-x: hidden;
        }
        /* éš±è—æ²è»¸ */
        ::-webkit-scrollbar { width: 0px; background: transparent; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- ç°¡æ˜“åœ–ç¤ºçµ„ä»¶ ---
        const Icon = ({ children, className, ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>
                {children}
            </svg>
        );

        const Icons = {
            Heart: (props) => <Icon {...props}><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></Icon>,
            Lock: (props) => <Icon {...props}><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></Icon>,
            Check: (props) => <Icon {...props}><polyline points="20 6 9 17 4 12"></polyline></Icon>,
            X: (props) => <Icon {...props}><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></Icon>,
            Volume2: (props) => <Icon {...props}><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></Icon>,
            VolumeX: (props) => <Icon {...props}><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><line x1="23" y1="9" x2="17" y2="15"></line><line x1="17" y1="9" x2="23" y2="15"></line></Icon>,
            Star: (props) => <Icon {...props}><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></Icon>,
            Upload: (props) => <Icon {...props}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></Icon>
        };

        // éš¨æ©Ÿæ´—ç‰Œå‡½æ•¸
        const shuffleArray = (array) => {
            const newArray = [...array];    
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        };

        const BirthdayApp = () => {
            // --- é¡Œç›®è¨­å®š ---
            const questionsData = [
                {
                    id: 1,
                    title: "ç¬¬ä¸€é—œï¼šå¿«æ¨‚æœæ•æ‰‹",
                    question: "è«‹èªªå‡º3å€‹æˆ‘å€‘åœ¨ä¸€èµ·å¾Œï¼Œä½ æ„Ÿåˆ°å¹¸ç¦æˆ–æ˜¯è®“ä½ ç™¼è‡ªå…§å¿ƒç¬‘å‡ºä¾†çš„æ™‚åˆ»?",
                    answer: "æ˜¯åœ¨å“­æ˜¯ä¸æ˜¯"
                },
                {
                    id: 2,
                    title: "ç¬¬äºŒé—œï¼šBy your side",
                    question: "è«‹èªªå‡º3å€‹ï¼Œç•¶ä½ åˆ°è¾›è‹¦æ™‚ï¼Œä½ å¸Œæœ›æˆ‘èƒ½é™ªä¼´ä½ çš„æ–¹å¼ï¼Ÿ",
                    answer: "æŠ±æŠ±~~~"
                },
                {
                    id: 3,
                    title: "ç¬¬ä¸‰é—œï¼šI see you",
                    question: "è«‹èªªå‡º3å€‹ï¼Œä½ è¦ºå¾—åœ¨ä¸€èµ·ä¹‹å¾Œï¼Œæˆ‘å€‘æ›´èªè­˜å½¼æ­¤çš„åœ°æ–¹ï¼Ÿ",
                    answer: "OHFUCK"
                },
                {
                    id: 4,
                    title: "ç¬¬å››é—œï¼š1+1>2",
                    question: "è«‹èªªå‡º3å€‹ï¼Œä½ å–œæ­¡çš„ç›¸è™•æ–¹å¼ï¼Œå¯ä»¥æ˜¯ç¾åœ¨æœ‰çš„æˆ–æ˜¯æœŸå¾…å¯ä»¥æœ‰çš„ï¼Ÿ",
                    answer: "æˆ‘æ„›ä½ "
                }
            ];

            // --- ç‹€æ…‹ç®¡ç† ---
            const [userUploadedImage, setUserUploadedImage] = useState(null);
            
            const [questionPieceMap, setQuestionPieceMap] = useState({});
            const [obtainedPieces, setObtainedPieces] = useState([]);
            const [completedQuestions, setCompletedQuestions] = useState([]);
            const [currentModal, setCurrentModal] = useState(null);
            const [inputValue, setInputValue] = useState("");
            const [errorMsg, setErrorMsg] = useState("");
            
            // æµç¨‹ç‹€æ…‹
            const [showConfetti, setShowConfetti] = useState(false);
            const [isMusicPlaying, setIsMusicPlaying] = useState(false);
            const [puzzleImageUrl, setPuzzleImageUrl] = useState(null);
            const [isGameSolved, setIsGameSolved] = useState(false); 
            
            // å°è©±æ¡†æµç¨‹
            const [showQuizDialog, setShowQuizDialog] = useState(false); // éšæ®µä¸€ï¼š9845å•ç­”
            const [showRevealDialog, setShowRevealDialog] = useState(false); // éšæ®µäºŒï¼šæ­æ›‰ç§˜å¯†
            const [titleMode, setTitleMode] = useState('initial'); // 'initial' | 'animating' | 'final'
            
            // 9845 å•ç­”ç‹€æ…‹
            const [quizError, setQuizError] = useState(false);

            // æ‹–æ›³ç›¸é—œç‹€æ…‹
            const [draggingPiece, setDraggingPiece] = useState(null); 
            const [dragOffset, setDragOffset] = useState({ x: 0, y: 0 });

            const boardRef = useRef(null); 
            const trayRef = useRef(null);

             // --- è™•ç†åœ–ç‰‡ä¸Šå‚³ ---
             const handleImageUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        setUserUploadedImage(reader.result);
                    };
                    reader.readAsDataURL(file);
                }
            };

            // --- åˆå§‹åŒ–ï¼šç”Ÿæˆæ‹¼åœ– ---
            useEffect(() => {
                if (!userUploadedImage) return;

                const allPieces = Array.from({ length: 16 }, (_, i) => i);
                const shuffled = shuffleArray(allPieces);
                const map = {};
                questionsData.forEach((q, index) => {
                    map[q.id] = shuffled.slice(index * 4, (index + 1) * 4);
                });
                setQuestionPieceMap(map);

                const width = 320; 
                const height = 320;
                
                const canvas = document.createElement('canvas');
                canvas.width = width;
                canvas.height = height;
                const ctx = canvas.getContext('2d');

                const img = new Image();
                img.src = userUploadedImage;
                
                img.onload = () => {
                    // A. ç¹ªè£½åº•åœ–
                    const scale = Math.max(width / img.width, height / img.height);
                    const x = (width / 2) - (img.width / 2) * scale;
                    const y = (height / 2) - (img.height / 2) * scale;
                    ctx.drawImage(img, x, y, img.width * scale, img.height * scale);

                    // B. ç¹ªè£½æ‰‹å¯«é¢¨æ ¼çš„é»‘è‰²æ•¸å­— (9845)
                    ctx.font = "bold 60px 'Dancing Script', 'Brush Script MT', 'Segoe Script', cursive";
                    ctx.fillStyle = "rgba(0, 0, 0, 0.85)"; 
                    ctx.textAlign = "center";
                    ctx.textBaseline = "middle";
                    ctx.shadowColor = "rgba(255, 255, 255, 0.4)";
                    ctx.shadowBlur = 5;

                    // ç¹ªè£½æ•¸å­—
                    ctx.save(); ctx.translate(85, 85); ctx.rotate(-0.1); ctx.fillText("9", 0, 0); ctx.restore();
                    ctx.save(); ctx.translate(235, 85); ctx.rotate(0.1); ctx.fillText("8", 0, 0); ctx.restore();
                    ctx.save(); ctx.translate(85, 235); ctx.rotate(0.05); ctx.fillText("4", 0, 0); ctx.restore();
                    ctx.save(); ctx.translate(235, 235); ctx.rotate(-0.05); ctx.fillText("5", 0, 0); ctx.restore();

                    setPuzzleImageUrl(canvas.toDataURL());
                };
            }, [userUploadedImage]);

            // --- æª¢æŸ¥éŠæˆ²æ˜¯å¦å®Œæˆ ---
            useEffect(() => {
                if (obtainedPieces.length < 16) return;
                const isSolved = obtainedPieces.every(p => p.currentSlot === p.id);
                
                if (isSolved && !isGameSolved) {
                    setIsGameSolved(true);
                    setShowConfetti(true);
                    
                    // ä¿®æ­£ï¼š2ç§’å¾Œè‡ªå‹•é—œé–‰æ…¶ç¥å½©ç ²ï¼Œé¿å…æ“‹åˆ°å°è©±æ¡†
                    setTimeout(() => setShowConfetti(false), 2000);

                    // å»¶é²å¾Œè·³å‡ºç¬¬ä¸€å€‹å°è©±æ¡† (9845 å•ç­”)
                    setTimeout(() => {
                        setShowQuizDialog(true);
                    }, 1500);
                }
            }, [obtainedPieces]);

            // --- è™•ç† 9845 å•ç­” ---
            const handleQuizAnswer = (optionIndex) => {
                if (optionIndex === 0) { // æ­£ç¢ºç­”æ¡ˆ (é¸é … 1)
                    setShowQuizDialog(false);
                    // é€²å…¥ä¸‹ä¸€å€‹éšæ®µï¼šæ­æ›‰ç§˜å¯†
                    setTimeout(() => {
                        setShowRevealDialog(true);
                    }, 500);
                } else {
                    // ç­”éŒ¯å‹•ç•«
                    setQuizError(true);
                    setTimeout(() => setQuizError(false), 500);
                }
            };

            // --- è™•ç†æ­æ›‰æŒ‰éˆ•é»æ“Š ---
            const handleReveal = () => {
                setShowRevealDialog(false);
                setTitleMode('final'); // è§¸ç™¼å‹•ç•«
                setShowConfetti(true);
                setTimeout(() => setShowConfetti(false), 8000);
            };

            // --- äº‹ä»¶è™•ç† (ç­”é¡Œæ‹¼åœ–) ---
            const handleOpenModal = (qId) => {
                if (completedQuestions.includes(qId)) return;
                setCurrentModal(qId);
                setInputValue("");
                setErrorMsg("");
            };

            const handleSubmit = () => {
                const question = questionsData.find(q => q.id === currentModal);
                if (inputValue.trim().toLowerCase().includes(question.answer.toLowerCase()) || inputValue.trim() === question.answer) {
                    const newPieceIds = questionPieceMap[question.id];
                    const newPieces = newPieceIds.map(id => ({ id, currentSlot: null }));
                    setObtainedPieces(prev => [...prev, ...newPieces]);
                    setCompletedQuestions(prev => [...prev, currentModal]);
                    setCurrentModal(null);
                } else {
                    setErrorMsg("ç­”æ¡ˆä¸å°å–”ï¼å†æƒ³æƒ³ï½");
                }
            };

            // --- æ‹–æ›³é‚è¼¯ ---
            const handlePointerDown = (e, pieceId) => {
                e.preventDefault(); 
                const pieceEl = e.currentTarget;
                const rect = pieceEl.getBoundingClientRect();
                
                setDraggingPiece({
                    id: pieceId,
                    startX: e.clientX,
                    startY: e.clientY,
                    initialLeft: rect.left,
                    initialTop: rect.top,
                    offsetX: e.clientX - rect.left,
                    offsetY: e.clientY - rect.top
                });
                pieceEl.setPointerCapture(e.pointerId);
            };

            const handlePointerMove = (e) => {
                if (!draggingPiece) return;
                e.preventDefault();
                const x = e.clientX - draggingPiece.startX;
                const y = e.clientY - draggingPiece.startY;
                setDragOffset({ x, y });
            };

            const handlePointerUp = (e) => {
                if (!draggingPiece) return;
                e.preventDefault();
                
                const dropX = e.clientX;
                const dropY = e.clientY;
                const boardRect = boardRef.current.getBoundingClientRect();
                const slotSize = boardRect.width / 4; 

                let landedSlot = null;

                if (
                    dropX >= boardRect.left && 
                    dropX <= boardRect.right && 
                    dropY >= boardRect.top && 
                    dropY <= boardRect.bottom
                ) {
                    const col = Math.floor((dropX - boardRect.left) / slotSize);
                    const row = Math.floor((dropY - boardRect.top) / slotSize);
                    landedSlot = row * 4 + col;
                }

                setObtainedPieces(prev => {
                    const next = [...prev];
                    const pieceIndex = next.findIndex(p => p.id === draggingPiece.id);
                    if (pieceIndex === -1) return prev; 

                    const existingPiece = next.find(p => p.currentSlot === landedSlot && p.id !== draggingPiece.id);
                    
                    if (landedSlot !== null && !existingPiece) {
                        next[pieceIndex] = { ...next[pieceIndex], currentSlot: landedSlot };
                    } else if (landedSlot !== null && existingPiece) {
                        // å¦‚æœæ ¼å­æœ‰äººï¼Œå½ˆå›
                    } else {
                        next[pieceIndex] = { ...next[pieceIndex], currentSlot: null };
                    }
                    return next;
                });

                setDraggingPiece(null);
                setDragOffset({ x: 0, y: 0 });
            };

            // --- æ¸²æŸ“ï¼šæ¨™é¡Œå‹•ç•«çµ„ä»¶ ---
            const AnimatedHeader = ({ mode }) => {
                const initialText = "Ready? Had a shiny, deep portal";
                const finalText = "Happy birthday my dear Stanley";
                
                // ç”¢ç”Ÿéš¨æ©Ÿé£›è¡Œåƒæ•¸
                const getRandomFly = () => {
                    const tx = (Math.random() - 0.5) * 200 + 'px';
                    const ty = (Math.random() - 0.5) * 100 - 50 + 'px';
                    const rot = (Math.random() - 0.5) * 120 + 'deg';
                    return { '--tx': tx, '--ty': ty, '--rot': rot };
                };

                return (
                    <h1 className="text-2xl md:text-3xl font-bold text-pink-600 flex items-center justify-center gap-2 min-h-[60px] flex-wrap relative w-full max-w-2xl mx-auto">
                        
                        {/* èˆŠæ¨™é¡Œï¼šåœ¨ final æ¨¡å¼æ™‚é£›å‡º */}
                        {mode !== 'final' && (
                            <div className={`absolute inset-0 flex items-center justify-center flex-wrap gap-1 transition-opacity duration-100 ${mode === 'final' ? 'pointer-events-none' : ''}`}>
                                <Icons.Heart className="fill-pink-500 text-pink-600 inline-block" size={24} />
                                <span className="font-mono flex flex-wrap justify-center">
                                    {initialText.split("").map((char, i) => (
                                        <span 
                                            key={i} 
                                            className={mode === 'final' ? "letter-fly-out" : ""}
                                            style={mode === 'final' ? getRandomFly() : {}}
                                        >
                                            {char === ' ' ? '\u00A0' : char}
                                        </span>
                                    ))}
                                </span>
                                <Icons.Heart className="fill-pink-500 text-pink-600 inline-block" size={24} />
                            </div>
                        )}

                        {/* æ–°æ¨™é¡Œï¼šåœ¨ final æ¨¡å¼æ™‚é£›å…¥ */}
                        {mode === 'final' && (
                            <div className="flex items-center justify-center flex-wrap gap-1">
                                <Icons.Star className="fill-yellow-400 text-yellow-500 animate-fade-in" size={24} />
                                <span className="font-mono flex flex-wrap justify-center text-pink-700">
                                    {finalText.split("").map((char, i) => (
                                        <span 
                                            key={i} 
                                            className="letter-fly-in"
                                            style={{
                                                ...getRandomFly(),
                                                animationDelay: `${i * 0.05}s` // é€å­—é£›å…¥
                                            }}
                                        >
                                            {char === ' ' ? '\u00A0' : char}
                                        </span>
                                    ))}
                                </span>
                                <Icons.Star className="fill-yellow-400 text-yellow-500 animate-fade-in" size={24} />
                            </div>
                        )}
                    </h1>
                );
            };


            // å¦‚æœé‚„æ²’ä¸Šå‚³åœ–ç‰‡ï¼Œé¡¯ç¤ºä¸Šå‚³ç•«é¢
            if (!userUploadedImage) {
                return (
                    <div className="min-h-screen flex flex-col items-center justify-center bg-pink-50 p-4">
                        <div className="bg-white p-8 rounded-2xl shadow-xl text-center max-w-md w-full border border-pink-100">
                            <div className="mb-6 flex justify-center text-pink-500">
                                <Icons.Heart size={64} className="animate-pulse" />
                            </div>
                            <h1 className="text-2xl font-bold text-gray-800 mb-4">æ­¡è¿ä¾†åˆ° Stanley çš„ç”Ÿæ—¥æŒ‘æˆ°ï¼</h1>
                            <p className="text-gray-600 mb-8">ç‚ºäº†é–‹å•Ÿé€™æ‰‡é–€ï¼Œ<br/>è«‹å…ˆä¸Šå‚³ä¸€å¼µå°ä½ å€‘ä¾†èªªæœ‰æ„ç¾©çš„ç…§ç‰‡ ğŸ“¸</p>
                            
                            <label className="cursor-pointer bg-pink-500 hover:bg-pink-600 text-white font-bold py-3 px-6 rounded-full shadow-lg transform hover:scale-105 transition-all flex items-center justify-center gap-2 mx-auto w-48">
                                <Icons.Upload size={20} />
                                é¸æ“‡ç…§ç‰‡
                                <input type="file" accept="image/*" onChange={handleImageUpload} className="hidden" />
                            </label>
                        </div>
                    </div>
                );
            }

            return (
                <div 
                    className="min-h-screen flex flex-col items-center py-8 font-sans text-gray-800 relative select-none"
                    style={{
                        backgroundColor: '#fffaf0',
                        backgroundImage: `
                            radial-gradient(circle at 10% 20%, rgba(255, 183, 178, 0.5) 0%, transparent 40%),
                            radial-gradient(circle at 90% 10%, rgba(181, 234, 215, 0.5) 0%, transparent 40%),
                            radial-gradient(circle at 30% 60%, rgba(226, 240, 203, 0.5) 0%, transparent 40%),
                            radial-gradient(circle at 80% 80%, rgba(199, 206, 234, 0.5) 0%, transparent 40%),
                            radial-gradient(circle at 50% 50%, rgba(255, 218, 185, 0.3) 0%, transparent 50%)
                        `,
                        backgroundAttachment: 'fixed',
                        backgroundSize: '120% 120%',
                        touchAction: 'none'
                    }}
                >
                    {/* éŸ³æ¨‚ */}
                    {isMusicPlaying && (
                        <iframe width="1" height="1" src="https://www.youtube.com/embed/an4ySOlsUMY?autoplay=1&loop=1&playlist=an4ySOlsUMY" title="Music" className="absolute opacity-0 pointer-events-none" />
                    )}
                    <button onClick={() => setIsMusicPlaying(!isMusicPlaying)} className={`fixed top-4 right-4 z-50 p-3 rounded-full shadow-lg transition flex items-center gap-2 ${isMusicPlaying ? 'bg-pink-500 text-white animate-pulse' : 'bg-white text-gray-400'}`}>
                        {isMusicPlaying ? <Icons.Volume2 size={20} /> : <Icons.VolumeX size={20} />}
                    </button>

                    {/* æ¨™é¡Œ (ä½¿ç”¨æ–°çš„çµ„ä»¶) */}
                    <header className="mb-6 text-center animate-bounce-slow bg-white/60 backdrop-blur-sm p-4 rounded-full shadow-sm border border-white/50 mt-12 md:mt-0 mx-4 w-full max-w-2xl">
                        <AnimatedHeader mode={titleMode} />
                        <p className={`mt-1 text-pink-500 text-sm font-medium transition-opacity duration-500 ${isGameSolved ? 'opacity-0' : 'opacity-100'}`}>
                            æº–å‚™å¥½äº†å—ï¼Ÿå‰é¢å‡ºç¾äº†ä¸€å€‹é–ƒäº®äº®åˆæ·±ä¸è¦‹åº•çš„å‚³é€é–€ï¼
                        </p>
                    </header>

                    <div className="w-full max-w-5xl flex flex-col md:flex-row items-start justify-center gap-8 px-4">
                        
                        {/* å·¦å´ï¼šå•é¡Œå€ */}
                        <div className={`flex flex-col gap-3 w-full md:w-1/4 transition-all duration-1000 ${isGameSolved ? 'opacity-50 blur-sm pointer-events-none' : ''}`}>
                            {questionsData.map((q) => {
                                const isCompleted = completedQuestions.includes(q.id);
                                return (
                                    <button
                                        key={q.id}
                                        onClick={() => handleOpenModal(q.id)}
                                        disabled={isCompleted}
                                        className={`
                                            p-3 rounded-xl shadow-md flex items-center justify-between transition-all transform hover:scale-105 backdrop-blur-sm text-left
                                            ${isCompleted 
                                                ? 'bg-green-100/90 text-green-700 border border-green-200 cursor-default' 
                                                : 'bg-white/90 hover:bg-pink-50 text-pink-600 border border-pink-200'}
                                        `}
                                    >
                                        <span className="font-bold text-md">{q.title}</span>
                                        {isCompleted ? <Icons.Check size={20} /> : <Icons.Lock size={20} />}
                                    </button>
                                );
                            })}
                        </div>

                        {/* ä¸­é–“ï¼šæ‹¼åœ–ç›¤é¢ (Board) */}
                        <div className="flex flex-col items-center gap-4">
                            <div className="relative group">
                                {/* ç™¼å…‰é‚Šæ¡† */}
                                <div className={`absolute -inset-2 bg-gradient-to-r from-pink-300 to-purple-300 rounded-2xl blur opacity-75 transition duration-1000 ${isGameSolved ? 'animate-pulse' : ''}`}></div>
                                
                                <div 
                                    ref={boardRef}
                                    className="relative bg-white p-2 rounded-xl shadow-2xl overflow-hidden transition-all duration-500" 
                                    style={{ width: '336px', height: '336px' }} 
                                >
                                    {/* å¦‚æœé€šé—œäº†ï¼Œé¡¯ç¤ºå®Œæ•´ç„¡ç¸«åœ– */}
                                    {isGameSolved ? (
                                        <div className="relative w-[320px] h-[320px]">
                                            <img 
                                                src={puzzleImageUrl} 
                                                className="w-full h-full object-cover rounded-lg" 
                                                alt="Solved Puzzle"
                                            />
                                        </div>
                                    ) : (
                                        /* å°šæœªé€šé—œ */
                                        <div className="w-[320px] h-[320px] grid grid-cols-4 grid-rows-4 bg-gray-100 rounded-lg border border-gray-200">
                                            {Array.from({ length: 16 }).map((_, slotIndex) => {
                                                const piece = obtainedPieces.find(p => p.currentSlot === slotIndex);
                                                return (
                                                    <div key={slotIndex} className="w-[80px] h-[80px] border border-dashed border-gray-300 flex items-center justify-center relative bg-white/50">
                                                        {piece && (
                                                            <div
                                                                className="w-[80px] h-[80px] absolute cursor-grab active:cursor-grabbing shadow-sm hover:shadow-md transition-shadow z-10"
                                                                style={{
                                                                    backgroundImage: `url(${puzzleImageUrl})`,
                                                                    backgroundSize: '320px 320px',
                                                                    backgroundPosition: `-${(piece.id % 4) * 80}px -${Math.floor(piece.id / 4) * 80}px`,
                                                                    transform: draggingPiece?.id === piece.id ? `translate(${dragOffset.x}px, ${dragOffset.y}px) scale(1.1)` : 'translate(0, 0)',
                                                                    zIndex: draggingPiece?.id === piece.id ? 50 : 10,
                                                                    touchAction: 'none'
                                                                }}
                                                                onPointerDown={(e) => handlePointerDown(e, piece.id)}
                                                                onPointerMove={handlePointerMove}
                                                                onPointerUp={handlePointerUp}
                                                            />
                                                        )}
                                                        {!piece && <span className="text-gray-200 text-xs select-none">+</span>}
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    )}
                                </div>
                            </div>

                            {/* æ‹¼åœ–å¾…é¸å€ */}
                            {!isGameSolved && (
                                <div ref={trayRef} className="w-[336px] min-h-[100px] bg-white/50 backdrop-blur-md rounded-xl border border-white/60 p-2 flex flex-wrap gap-2 justify-center items-center shadow-inner">
                                    {obtainedPieces.filter(p => p.currentSlot === null).length === 0 && completedQuestions.length < 4 && (
                                        <p className="text-gray-400 text-sm">å›ç­”å•é¡Œä¾†ç²å¾—æ‹¼åœ–...</p>
                                    )}
                                    {obtainedPieces.filter(p => p.currentSlot === null).map((piece) => (
                                        <div
                                            key={piece.id}
                                            className="w-[80px] h-[80px] cursor-grab active:cursor-grabbing shadow-md rounded-sm hover:scale-105 transition-transform bg-white relative"
                                            style={{
                                                backgroundImage: `url(${puzzleImageUrl})`,
                                                backgroundSize: '320px 320px',
                                                backgroundPosition: `-${(piece.id % 4) * 80}px -${Math.floor(piece.id / 4) * 80}px`,
                                                transform: draggingPiece?.id === piece.id ? `translate(${dragOffset.x}px, ${dragOffset.y}px) scale(1.1)` : 'translate(0, 0)',
                                                zIndex: draggingPiece?.id === piece.id ? 50 : 1,
                                                touchAction: 'none'
                                            }}
                                            onPointerDown={(e) => handlePointerDown(e, piece.id)}
                                            onPointerMove={handlePointerMove}
                                            onPointerUp={handlePointerUp}
                                        />
                                    ))}
                                </div>
                            )}
                        </div>
                    </div>

                    {/* ç­”é¡Œå°è©±æ¡† */}
                    {currentModal && (
                        <div className="fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center z-50 px-4">
                            <div className="bg-white/95 rounded-2xl p-6 w-full max-w-sm shadow-2xl animate-fade-in border border-pink-100">
                                <h3 className="text-xl font-bold text-pink-600 mb-2">{questionsData.find(q => q.id === currentModal).title}</h3>
                                <p className="text-gray-600 mb-4 text-lg">{questionsData.find(q => q.id === currentModal).question}</p>
                                <input
                                    type="text"
                                    value={inputValue}
                                    onChange={(e) => setInputValue(e.target.value)}
                                    placeholder="è«‹è¼¸å…¥ç­”æ¡ˆ..."
                                    className="w-full border-2 border-pink-200 rounded-lg p-3 focus:outline-none focus:border-pink-500 mb-2"
                                    onKeyDown={(e) => e.key === 'Enter' && handleSubmit()}
                                />
                                {errorMsg && <p className="text-red-500 text-sm mb-2">{errorMsg}</p>}
                                <div className="flex justify-end gap-2 mt-4">
                                    <button onClick={() => setCurrentModal(null)} className="px-4 py-2 text-gray-500 hover:bg-gray-100 rounded-lg">å–æ¶ˆ</button>
                                    <button onClick={handleSubmit} className="px-6 py-2 bg-pink-500 text-white rounded-lg hover:bg-pink-600 shadow-md">ç¢ºèª</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* éšæ®µä¸€ï¼š9845 å•ç­”å°è©±æ¡† */}
                    {showQuizDialog && (
                        <div className="fixed inset-0 bg-black/60 backdrop-blur-md flex items-center justify-center z-50 px-4 animate-fade-in">
                            <div className={`bg-white rounded-3xl p-8 w-full max-w-md shadow-2xl text-center border-4 border-pink-200 relative overflow-hidden ${quizError ? 'animate-shake' : ''}`}>
                                
                                <h2 className="text-2xl font-bold text-gray-800 mb-6">æ‹¼åœ–å®Œæˆäº†ï¼<br/>ä½†é€™è£¡é‚„æœ‰ä¸€å€‹å°è€ƒé¡Œ...</h2>
                                <p className="text-lg text-pink-600 font-bold mb-6">ä½ çŸ¥é“ç…§ç‰‡ä¸Šçš„ <span className="font-mono text-2xl mx-1 bg-pink-100 px-2 rounded">9845</span> æ˜¯ä»€éº¼æ„æ€å—?</p>
                                
                                <div className="flex flex-col gap-3">
                                    <button onClick={() => handleQuizAnswer(0)} className="py-3 px-4 bg-gray-50 hover:bg-pink-500 hover:text-white rounded-xl border border-gray-200 transition-all font-medium text-left">
                                        1. ä½ å­˜åœ¨åœ¨ä¸–ç•Œä¸Š9845å¤©
                                    </button>
                                    <button onClick={() => handleQuizAnswer(1)} className="py-3 px-4 bg-gray-50 hover:bg-pink-500 hover:text-white rounded-xl border border-gray-200 transition-all font-medium text-left">
                                        2. æˆ‘å€‘åœ¨ä¸€èµ·äº†9845å€‹å°æ™‚
                                    </button>
                                    <button onClick={() => handleQuizAnswer(2)} className="py-3 px-4 bg-gray-50 hover:bg-pink-500 hover:text-white rounded-xl border border-gray-200 transition-all font-medium text-left">
                                        3. æˆ‘å€‘ä¸€èµ·èŠ±äº†9845å€‹å°æ™‚è¿½åŠ‡
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* éšæ®µäºŒï¼šæ­æ›‰ç§˜å¯†å°è©±æ¡† */}
                    {showRevealDialog && (
                        <div className="fixed inset-0 bg-black/60 backdrop-blur-md flex items-center justify-center z-50 px-4 animate-fade-in">
                            <div className="bg-white rounded-3xl p-8 w-full max-w-md shadow-2xl text-center border-4 border-pink-200 relative overflow-hidden">
                                {/* å·¦ä¸Šå½©ç ² */}
                                <div className="absolute top-2 left-2 text-3xl animate-bounce">ğŸ‰</div>
                                {/* å³ä¸Šå½©ç ² */}
                                <div className="absolute top-2 right-2 text-3xl animate-bounce" style={{ animationDelay: '0.2s' }}>ğŸ‰</div>
                                
                                <div className="mb-4 mt-4 inline-block bg-pink-100 p-4 rounded-full">
                                    <Icons.Star size={48} className="text-yellow-500 animate-spin-slow" style={{ animationDuration: '4s' }} />
                                </div>
                                
                                <h2 className="text-2xl font-bold text-gray-800 mb-4">ç­”å°äº†ï¼</h2>
                                
                                <p className="text-gray-600 mb-8 text-lg leading-relaxed">
                                    æœ€å¾Œä¸€å€‹å°ç§˜å¯†ï¼Œä½ æœ‰ç™¼ç¾æ¨™é¡Œ<br/>
                                    <span className="font-mono font-bold text-pink-600 bg-pink-50 px-2 py-1 rounded inline-block mt-1">"Ready? Had a shiny, deep portal"</span><br/>
                                    æœ‰ä»€éº¼ç„æ©Ÿå—?
                                </p>
                                
                                <button 
                                    onClick={handleReveal}
                                    className="w-full py-3 bg-gradient-to-r from-pink-500 to-purple-500 text-white rounded-xl font-bold shadow-lg hover:shadow-xl transform hover:-translate-y-1 transition-all flex items-center justify-center gap-2"
                                >
                                    <Icons.Star className="fill-yellow-400 text-yellow-500" />
                                    è«‹æ­æ›‰
                                </button>
                            </div>
                        </div>
                    )}

                    {/* æ…¶ç¥ç‰¹æ•ˆ */}
                    {showConfetti && (
                        <div className="fixed inset-0 pointer-events-none flex items-center justify-center z-50 overflow-hidden">
                            <div className="absolute inset-0 bg-pink-500/10 animate-pulse"></div>
                            <div className="text-6xl animate-bounce">ğŸ‰</div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<BirthdayApp />);
    </script>
</body>
</html>
